{{ define "main" }}
<section class="home-about">
	<div class="avatar">
        {{ if isset .Site.Params "avatarurl" }}
        <img class={{ .Site.Params.AvatarSize | default "size-m" }} src='{{ .Scratch.Get "avatarImgSrc" }}' alt="{{ .Site.Params.AvatarAltText|default "avatar" }}">
        {{ end }}
	</div>

    <h1>{{ .Site.Title }}</h1>
    {{ if isset .Site.Params "description" }}
        <h2>{{ .Site.Params.Description }}</h2>
    {{ end }}

</section>

<div class="flex-break"></div>

{{ if isset .Site.Params "socialicons" }}
{{ .Scratch.Set "emailAddr" "" }}
<div class="gk-social-icons">
    <ul class="gk-social-icons-list">
        {{ range .Site.Params.SocialIcons }}
        {{- $name := (.name | lower) -}}
        {{- $isEmail := eq $name "email" -}}
        {{- if $isEmail -}}
            {{- $.Scratch.Set "emailAddr" (replace .url "mailto:" "") -}}
        {{- end -}}
        <li class="gk-social-icon">
            <a href="{{ .url }}"
               {{ if not $isEmail }}target="_blank" rel="{{ if .rel }}{{ .rel }} {{ end }}noopener noreferrer"{{ end }}
               aria-label="{{ if $isEmail }}Email{{ else }}Learn more on {{ $name }}{{ end }}"
               title="{{ if $isEmail }}{{ $.Scratch.Get "emailAddr" }}{{ else }}{{ $name }}{{ end }}">
                <img class="svg-inject" src="{{ relURL "svg/icons/" }}{{ $name }}.svg" alt="">
            </a>
        </li>
        {{ end }}
    </ul>
</div>

{{ $emailAddr := .Scratch.Get "emailAddr" }}
{{ if $emailAddr }}
<div style="margin-top: 0.4rem;">
    <a href="mailto:{{ $emailAddr }}">{{ $emailAddr }}</a>
</div>
{{ end }}
{{ end }}

{{ if (or
    (and (fileExists "content/_index.md") .Content)
    (fileExists "content/index-about.md")) }}
        <section class="home-content">
            {{ or .Content (readFile "index-about.md" | markdownify) }}
        </section>
{{ end }}

{{ if isset .Site.Params "showpostsonhomepage" }}

    <div class="home-posts list-posts">
        <h2>{{ i18n (.Site.Params.ShowPostsOnHomePage | humanize) }}</h2>

    {{ $posts := where .Site.Pages "Params.type" "post" }}

    {{ if eq .Site.Params.ShowPostsOnHomePage "popular" }}
        {{ range $posts.ByWeight | first (or .Site.Params.NumberPostsOnHomePage 4) }}
            {{- partial "list-posts.html" . -}}
        {{ end }}
    {{ else if eq .Site.Params.ShowPostsOnHomePage "recent" }}
        {{ range $posts.ByDate.Reverse | first (or .Site.Params.NumberPostsOnHomePage 4) }}
            {{- partial "list-posts.html" . -}}
        {{ end }}
    {{ end }}
    </div>

{{ end }}
{{ end }}

